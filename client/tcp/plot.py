import re
import matplotlib.pyplot as plt
import numpy as np


fp = open("data.txt", 'r')
data = [[], [], [], [], [], []]
print(data)
i = 0
for line in fp.readlines():
    if "Mb " in line.strip():
        data[int(i / 8)].append(float(line.split()[-1]))
        i += 1
print(data)
data1 = [
    [97.09112046670036, 97.9699354361211, 98.99491100603663, 94.90785360579933, 94.77861009836226, 67.09948912577138, 63.49221832301603, 32.48898120285762], 
    [196.1978373083388, 146.91931407594484, 121.9055704924867, 177.1871603405597, 185.56735618346937, 170.9885290386994, 158.75084789122343, 1.6280147760937924], 
    [393.29893076672965, 221.62774435753104, 184.40528969752626, 127.58431941068773, 125.4439912663135, 45.87936068452208, 5.592851307296577, 1.216431363905291], 
    [582.486931470524, 343.7149960223445, 331.40382277644784, 283.17633097931576, 149.1039118685559, 74.31099552198266, 6.785044136978996, 2.0344865958169094], 
    [756.127917150924, 503.8043605441484, 367.20642803243646, 313.9253118764643, 330.1553510289462, 115.631114242966, 15.378928911633018, 1.0034254273372063], 
    [944.8842675993025, 609.6151129696516, 508.878486233033, 376.0138475097682, 226.37687586004367, 138.89997005869498, 13.458968111945918, 1.0690622324292338]
]
data2 = [
    [95.0884, 92.9974, 93.1545, 92.4047, 89.6948, 82.9807, 73.056, 49.3877],
    [189.405, 188.552, 187.332, 182.55, 179.041, 156.842, 138.885, 70.4382],
    [377.313, 369.927, 348.125, 318.185, 274.486, 300.897, 259.612, 119.854],
    [567.092, 539.4, 467.965, 331.954, 268.477, 198.247, 169.708, 132.291],
    [748.188, 712.456, 404.138, 277.289, 235.665, 174.59, 143.349, 153.661],
    [904.304, 726.435, 393.237, 278.092, 245.828, 205.154, 160.883, 121.029],
]




for i, rate in enumerate([100, 200, 400, 600, 800, 1000]):
    plt.figure()
    loss = ('0', '0.3', '1', '3', '5', '10' , '15', '20')
    bar_width = 0.2
    index = np.arange(len(loss))  
    index_udt_bbr = index - 0.1
    index_bbr = index
    index_core_bbr = index + 0.1
    plt.bar(index_udt_bbr, height=data2[i], width=bar_width, color='b', label='bbr-udt')
    plt.bar(index_core_bbr, height=data1[i], width=bar_width, color='r', label='bbr-core')
    # plt.bar(index_bbr, height=data1[rtt], width=bar_width, color='r', label='bbr')
    # str1 = rtt.split('_')
    # plt.bar(index_udt, height=data1[bandwidth][str1[0]], width=bar_width, color='r', label='udt-vpn')
    plt.legend()  
    plt.xticks(index, loss)  
    plt.xlabel('loss_rate(%)') 
    plt.ylabel('goodput (Mbits/s)')  
    plt.title(f"link-bw: {rate}(Mbits/s)")  #
    plt.savefig(f'data/{rate}M_BBR.jpg')